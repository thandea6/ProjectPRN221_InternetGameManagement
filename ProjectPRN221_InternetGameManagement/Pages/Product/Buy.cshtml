@page
@model ProjectPRN221_InternetGameManagement.Pages.Product.BuyModel
@{
    ViewData["Title"] = "Buy Product";
    Layout = null;
}
<h2>Select Product</h2>

<!-- Nút Back để quay lại trang User/UserManager -->
<div style="position: absolute; top: 10px; right: 10px;">
    <button onclick="location.href='@Url.Page("/User/UserScreen")'">Back</button>
</div>

<!-- Combobox Filter -->
<label for="categoryFilter">Filter by Category:</label>
<select id="categoryFilter" asp-for="SelectedCategory" asp-items="Model.Categories" onchange="filterProducts()">
    <option value="">All Categories</option>
</select>

<!-- List of Products -->
<table border="1" cellpadding="10" cellspacing="0">
    <thead>
        <tr>
            <th>Product ID</th>
            <th>Product Name</th>
            <th>Category</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="productList">
        @foreach (var product in Model.FilteredProducts)
        {
            <tr>
                <td>@product.Id</td>
                <td>@product.Name</td>
                <td>@product.Category</td>
                <td>@product.Price</td>
                <td>
                    <!-- Form POST để thêm sản phẩm vào bill -->
                    <form method="post" asp-page-handler="AddToBill">
                        <input type="hidden" name="productId" value="@product.Id" />
                        <button type="submit">Buy</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Bill Section -->
<h3>Bill</h3>
<table border="1" cellpadding="10" cellspacing="0" id="billTable">
    <thead>
        <tr>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Price</th>
            <th>Total Price</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="billItems">
        @foreach (var detail in Model.BillDetails)
        {
            <tr>
                <td>@Model.FilteredProducts.FirstOrDefault(p => p.Id == detail.ProductId)?.Name</td>
                <td>@detail.Quantity</td>
                <td>@detail.Price</td>
                <td>@detail.TotalPrice</td>
                <td>
                    <form method="post" asp-page-handler="DeleteBillDetail" asp-route-billDetailId="@detail.Id">
                        <button type="submit">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<p>Total: $<span id="totalAmount">@Model.TotalAmount</span></p>

<script>
    function filterProducts() {
        let selectedCategory = document.getElementById("categoryFilter").value;
        window.location.href = '@Url.Page("/Product/Buy")?category=' + selectedCategory;
    }
</script>